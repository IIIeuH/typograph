function btnHide(e,t,a,n){e.show(),t.removeClass("hidden"),a.removeClass("hidden"),n.addClass("hidden")}function btnShow(e,t,a,n){e.hide(),a.addClass("hidden"),n.addClass("hidden"),t.removeClass("hidden")}function sandData(e){var t=e.val(),a=[];null!==t?(t.forEach(function(e){var t={};t.name=e,a.push(t)}),a=JSON.stringify(a),$.ajax({type:"PUT",data:{data:a},success:function(e){Snackbar.show({text:"Данные успешно сохраненны!",pos:"bottom-left",actionText:null}),window.location.reload()},error:function(e){Snackbar.show({text:"Что-то пошло не так!",pos:"bottom-left",actionText:null})}})):Snackbar.show({text:"Заполните поле!",pos:"top-center",actionText:"OK",actionTextColor:"#ff0000"})}function removeRow(e){var t=e.attr("id");$.ajax({type:"DELETE",data:{id:t},success:function(){e.parent().parent().hide()},error:function(){Snackbar.show({text:"Что-то пошло не так!",pos:"bottom-left",actionText:null})}})}function searchPassports(e,t){$.each(t,function(){var t=$(this).parent();~$(this).text().indexOf(e)||""===e?t.show():t.hide()})}function addCar(){var e=$(".car-container");e.length<8&&e.last().after('<div class="car-container">\n  <table class="table table-bordered table-condensed car-tabel">\n    <tr>\n      <td>\n        <div class="row">\n          <div class="col-md-12">\n            <div class="form-group">\n              <label class="col-md-5 control-label">На машину</label>\n              <div class="col-md-7">\n                <select class="form-control car-select" required>\n                  <option>A2</option>\n                  <option>A3</option>\n                </select>\n              </div>\n            </div>\n          </div>\n        </div>\n        <div class="form-group">\n          <label class="col-md-5 control-label">Шт.</label>\n          <div class="col-md-7">\n            <input type="text" class="form-control Sht" required/>\n          </div>\n        </div>\n        <div class="form-group">\n          <label class="col-md-5 control-label">На</label>\n          <div class="col-md-7">\n            <input type="text" class="form-control on" required/>\n          </div>\n        </div>\n        <div class="form-group">\n          <label class="col-md-5 control-label">Печ. листов</label>\n          <div class="col-md-7">\n            <input type="text" class="form-control printSheet" required/>\n          </div>\n        </div>\n        <div class="form-group">\n          <label class="col-md-5 control-label">Исходных листов</label>\n          <div class="col-md-7">\n            <input type="text" class="form-control allSheet" required/>\n          </div>\n        </div>\n      </td>\n    </tr>\n    <tr>\n      <td>\n        <textarea cols="30" class="signature"></textarea>\n      </td>\n    </tr>\n  </table>\n</div>')}function sourceSheets(el){var del=el.parents(".car-tabel").find(".on").val().slice("\\")[2]||0,printSheet=eval(el.parents(".car-tabel").find(".printSheet").val())||0,res=printSheet/del;isInteger(res)||(res=res.toFixed(2)),el.parents(".car-tabel").find(".allSheet").val(res)}function isInteger(e){return(0^e)===e}function removeCar(){var e=$(".car-container");e.length>1&&e.last().remove()}$(function(){var e=$(".add-btn"),t=$(".cancel-btn"),a=$(".save-btn"),n=$(".row-papper"),r=$(".removeRow");$(".text").on("select2:select",function(e){var t=e.params.data.element,a=$(t);a.detach(),$(this).append(a),$(this).trigger("change")}),n.hide(),e.click(function(){btnHide(n,t,a,$(this))}),t.click(function(){btnShow(n,e,a,$(this))}),a.click(function(){sandData($("#type-papper"))}),r.click(function(){if(!confirm("Вы действительно хотите удалить "+$(this).data("name")+"?"))return!1;removeRow($(this))}),$(document).on("click",".close",function(){console.log($(this).parent("row")),$(".permiss").length>1&&$(this).parents(".permiss").remove()}),$(document).on("click","#addPermissions",function(){$(this).before('<div class="row permiss">\n  <div class="col-md-6">\n    <button type="button" data-dismiss="alert" class="close">×</button>\n    <div class="col-md-6">\n      <div class="form-group label-floating">\n        <label class="control-label">Url</label>\n        <input type="text" required class="form-control name"/>\n      </div>\n    </div>\n    <div class="col-md-6">\n      <div class="form-group label-floating">\n        <label class="control-label">Доступ</label>\n        <select class="form-control access" required>\n          <option value="1" selected="selected">Чтение</option>\n          <option value="2">Чтение/Запись</option>\n          <option value="3">Чтение/Запись/Удаление</option>\n        </select>\n      </div>\n    </div>\n  </div>\n</div>'),$(".access").select2()})}),$(function(){var e=$("#add-customer"),t=$("#remove-customer"),a=$("#add-name"),n=$("#remove-name"),r=$("#car-add"),o=$("#car-remove"),s=$(".passport-date"),l=$(".passport-id"),i=$(".passport-customer"),c=$(".passport-manager"),d=$("#searchDate"),p=$("#searchId"),m=$("#searchCustomer"),u=$("#searchManager"),v=$('select:not(".car-select")'),h=($("select.mult"),$('select:not(".size-paper")'),window.location);$('ul.nav a[href="'+h+'"]').parent().addClass("active"),$("ul.nav a").filter(function(){return this.href==h}).parent().addClass("active"),$.material.init(),$('input[type="tel"]').mask("+7(999) 999-9999"),v.select2(),$(".text").select2({tags:!0,tokenSeparators:[","," "]}),$(".size-paper").select2({tags:!0,tokenSeparators:[","," "]}),$(".checkbox-select").select2({tags:!0,tokenSeparators:[","," "]}),v.on("select2:select",function(e){var t=e.params.data.element,a=$(t);a.detach(),$(this).append(a),$(this).trigger("change")}),$("#noFile").click(function(){$(this).prop("checked")?$("#file").removeAttr("disabled"):$("#file").attr("disabled","disabled")}),$("#typepapper").select2({tags:!0,tokenSeparators:[","," "],placeholder:"Тип",ajax:{url:"/getCollection",dataType:"json",data:function(e){return{term:e.term,collection:"typepappers"}},processResults:function(e){return{results:$.map(e,function(e){return{text:e.name,id:e.name}})}}}}),$("#grammpapper").select2({tags:!0,tokenSeparators:[","," "],placeholder:"Граммаж",ajax:{url:"/getCollection",dataType:"json",data:function(e){return{term:e.term,collection:"grammpappers"}},processResults:function(e){return{results:$.map(e,function(e){return{text:e.name,id:e.name}})}}}}),$("#sizepapper").select2({tags:!0,tokenSeparators:[","," "],placeholder:"Размер",ajax:{url:"/getCollection",dataType:"json",data:function(e){return{term:e.term,collection:"sizepappers"}},processResults:function(e){return{results:$.map(e,function(e){return{text:e.name,id:e.name}})}}}}),$("#manager").select2({placeholder:"Менеджер",ajax:{url:"/getCollection",dataType:"json",data:function(e){return{term:e.term,collection:"users"}},processResults:function(e){return{results:$.map(e,function(e){return{text:e.name,id:e.name}})}}}}),e.click(function(){addCustomer()}),t.click(function(){removeCustomer()}),a.click(function(){addName()}),n.click(function(){removeName()});var f=$("#timeCheck"),b=$("#timeInput");f.click(function(){$(this).prop("checked")?b.removeAttr("disabled"):b.attr("disabled","disabled")}),r.click(function(){addCar()}),o.click(function(){removeCar()}),$(document).on("change",".on, .printSheet",function(){sourceSheets($(this))}),$("#file").change(function(){var e=$(this).val(),t=e.split("\\");e=e.replace(t[t.length-1],""),$("#fullPath").html(e)});var y=$('input[name="delivery"]'),g=$(".type-delever"),k=$('input[name="type-delivery"]'),x=$(".bus"),S=$(".delivery-address"),P=$(".address");x.hide(),S.hide(),g.hide(),"Доставка"===$('input[name="delivery"]:checked').val()?g.show():(g.hide(),k.prop("checked",!1),P.val(""),S.hide(),x.hide());var w=$('input[name="type-delivery"]:checked').val();"Автобус"===w||void 0==w?(x.show(),S.hide(),P.val("")):(S.show(),x.hide()),y.on("change",function(){"Доставка"===$('input[name="delivery"]:checked').val()?g.show():(g.hide(),k.prop("checked",!1),P.val(""),S.hide(),x.hide())}),k.on("change",function(){"Автобус"===$('input[name="type-delivery"]:checked').val()?(x.show(),S.hide(),P.val("")):(S.show(),x.hide())}),d.keyup(function(){searchPassports($(this).val(),s)}),p.keyup(function(){searchPassports($(this).val(),l)}),m.keyup(function(){searchPassports($(this).val(),i)}),u.keyup(function(){searchPassports($(this).val(),c)}),"/"===window.location.pathname?$(".chat").show():$(".chat").hide(),$(".patter").each(function(){$(this).keyup(function(){var e=$(this).val(),t=/[!@#$%^&*()_\\;,."']/i.test(e);t&&(t=e.replace(/[!@#$%^&*()_\\;,."']/i,""),t&&Snackbar.show({text:"Записи разделаются только пробелом!",pos:"top-center",actionText:null}),$(this).val(t))})}),$("#print").click(function(){window.print()})}),$(function(){var e=($("#savePassportBtn"),$("#formPassport")),t=io();e.on("submit",function(e){var a={};a.sizePaper=[],a.typePaper=[],a.typePaperSize=[],a.typePaperGramm=[],a.decoration=[],a.manager=[],a.allCar=[],a.passOn=$(".pass-on").val()||"",a.timePassport=$(".time").val()||"",a.contactPerson=$(".contact-person").val()||"",a.phone=$(".phone").val()||"",a.customer=$(".customer").val()||"",a.name=$(".name").val()||"",a.circulationFiled=$(".circulation").val()||"",a.page=$(".page").val()||"",a.redness=$(".redness").val()||"",a.file=$(".fileText").val()||"",a.comment=$(".comment").val()||"",a.address=$(".address").val()||"",a.date=moment().format("DD.MM.YYYY")||"",a.timeSave=moment().format("hh:mm")||"",a.passportId=moment().format("DDMMYYYY")||"",a.deliveryFiled=$('input[name="delivery"]:checked').val()||"",a.typeDeliveryFiled=$('input[name="type-delivery"]:checked').val()||"",a.sizePaper=$(".size-paper").val()||[],a.typePaper=$(".typePaper").val()||[],a.typePaperSize=$(".typePaperSize").val()||[],a.typePaperGramm=$(".typePaperGramm").val()||[],a.set=$(".set").val()||[],a.decoration=$(".decoration").val()||[],a.manager=$(".manager").val()||[],a.managerId=$("#managerId").val(),$(".car-container").each(function(){var e={};e.car=$(this).find(".car-select").val(),e.sht=$(this).find(".Sht").val(),e.on=$(this).find(".on").val(),e.printSheet=$(this).find(".printSheet").val(),e.allSheet=$(this).find(".allSheet").val(),e.signature=$(this).find(".signature").val(),a.allCar.push(e)});var n=!0;if(t.emit("savePassportBtn",a),t.on("readySavePassport",function(e){412===e.status?(Snackbar.show({text:e.msg,pos:"top-center",actionText:null}),n=!1):n=!0}),!n)return!1}),$("#updatePassportBtn").on("click",function(e){var a={};a.sizePaper=[],a.typePaper=[],a.typePaperSize=[],a.typePaperGramm=[],a.decoration=[],a.manager=[],a.allCar=[],a.passOn=$(".pass-on").val()||"",a.timePassport=$(".time").val()||"",a.contactPerson=$(".contact-person").val()||"",a.phone=$(".phone").val()||"",a.customer=$(".customer").val()||"",a.name=$(".name").val()||"",a.circulationFiled=$(".circulation").val()||"",a.page=$(".page").val()||"",a.redness=$(".redness").val()||"",a.file=$(".fileText").val()||"",a.comment=$(".comment").val()||"",a.address=$(".address").val()||"",a.date=moment().format("DD.MM.YYYY")||"",a.timeSave=moment().format("hh:mm")||"",a.passportId=moment().format("DDMMYYYY")||"",a.deliveryFiled=$('input[name="delivery"]:checked').val()||"",a.typeDeliveryFiled=$('input[name="type-delivery"]:checked').val()||"",a.sizePaper=$(".size-paper").val()||[],a.typePaper=$(".typePaper").val()||[],a.typePaperSize=$(".typePaperSize").val()||[],a.typePaperGramm=$(".typePaperGramm").val()||[],a.set=$(".set").val()||[],a.decoration=$(".decoration").val()||[],a.manager=$(".manager").val()||[],a.managerId=$(".managerId").val(),$(".car-container").each(function(){var e={};e.car=$(this).find(".car-select").val(),e.sht=$(this).find(".Sht").val(),e.on=$(this).find(".on").val(),e.printSheet=$(this).find(".printSheet").val(),e.allSheet=$(this).find(".allSheet").val(),e.signature=$(this).find(".signature").val(),a.allCar.push(e)});var n=window.location.pathname.split("/")[3],r=!0;if(t.emit("updatePassportBtn",{data:a,id:n}),t.on("readyUpdatePassport",function(e){412===e.status?(Snackbar.show({text:e.msg,pos:"top-center",actionText:null}),r=!1):(Snackbar.show({text:e.msg,pos:"top-center",actionText:null}),r=!0)}),!r)return!1})}),$(function(){var e=$("#profileUpdate"),t={};e.click(function(){t.name=$("#name").val(),$.ajax({url:"/manager/profile",type:"post",data:t,success:function(e){Snackbar.show({text:"Данные успешно сохраненны!",pos:"bottom-left",actionText:null})},error:function(e){Snackbar.show({text:"Что-то пошло не так!",pos:"bottom-left",actionText:null})}})})}),$(function(){$("#saveUser").click(function(){var e={};e.email=$('input[name="email"]').val(),e.role=$('input[name="role"]').val(),e.name=$('input[name="name"]').val();var t=[];$(".permiss").each(function(){var e={};e.name=$(this).find(".name").val(),e.access=+$(this).find(".access").val(),t.push(e)}),e.permissions=t,$.ajax({type:"POST",data:{data:JSON.stringify(e)},success:function(e){Snackbar.show({text:"Данные успешно сохраненны!",pos:"bottom-left",actionText:null})},error:function(e){Snackbar.show({text:"Что-то пошло не так! "+e,pos:"bottom-left",actionText:null})}})})});