"use strict";function btnHide(t,e,a,n){t.show(),e.removeClass("hidden"),a.removeClass("hidden"),n.addClass("hidden")}function btnShow(t,e,a,n){t.hide(),a.addClass("hidden"),n.addClass("hidden"),e.removeClass("hidden")}function sandData(t){var e=t.val(),a=[];null!==e?(e.forEach(function(t){var e={};e.name=t,a.push(e)}),a=JSON.stringify(a),$.ajax({type:"PUT",data:{data:a},success:function(t){Snackbar.show({text:"Данные успешно сохраненны!",pos:"bottom-left",actionText:null}),window.location.reload()},error:function(t){Snackbar.show({text:"Что-то пошло не так!",pos:"bottom-left",actionText:null})}})):Snackbar.show({text:"Заполните поле!",pos:"top-center",actionText:"OK",actionTextColor:"#ff0000"})}function removeRow(t){var e=t.attr("id");$.ajax({type:"DELETE",data:{id:e},success:function(){t.parent().parent().hide()},error:function(t){console.log(t.responseText),Snackbar.show({text:t.responseText,pos:"top-center",actionText:null})}})}function searchPassports(t,e){$.each(e,function(){var e=$(this).parent();~$(this).text().toLowerCase().indexOf(t.toLowerCase())||""===t.toLowerCase()?e.show():e.hide()})}function addCar(){var t=$(".car-container");t.length<8&&t.last().after('<div class="car-container">\n  <table class="table table-bordered table-condensed car-tabel">\n    <tr>\n      <td>\n        <div class="row">\n          <div class="col-md-12">\n            <div class="form-group">\n              <label class="col-md-3 control-label">На машину</label>\n              <div class="col-md-3">\n                <select style="margin-top: 10px;" required="required" class="form-control typePaper"></select>\n              </div>\n            </div>\n            <div class="form-group">\n              <div class="col-md-3">\n                <select required="required" class="form-control car-select not-select">\n                  <option>A2</option>\n                  <option>A3</option>\n                </select>\n              </div>\n            </div>\n            <div class="form-group">\n              <div class="col-md-3">\n                <input class="form-control comment-top"/>\n              </div>\n            </div>\n          </div>\n        </div>\n        <div class="form-group">\n          <label class="col-md-5 control-label">Шт.</label>\n          <div class="col-md-3">\n            <input type="text" required="required" class="form-control Sht"/>\n          </div>\n          <div class="col-md-4">\n            <select required="required" class="form-control typePaperGramm"></select>\n          </div>\n        </div>\n        <div class="form-group">\n          <label class="col-md-5 control-label">На</label>\n          <div class="col-md-3">\n            <input type="text" required="required" class="form-control on"/>\n          </div>\n        </div>\n        <div class="form-group">\n          <div class="col-md-4">\n            <select required="required" class="form-control typePaperSize"></select>\n          </div>\n        </div>\n        <div class="form-group">\n          <label class="col-md-5 control-label">Печ. листов</label>\n          <div class="col-md-7">\n            <input type="text" required="required" class="form-control printSheet"/>\n          </div>\n        </div>\n        <div class="form-group">\n          <label class="col-md-5 control-label">Исходных листов</label>\n          <div class="col-md-7">\n            <input type="text" required="required" class="form-control allSheet"/>\n          </div>\n        </div>\n      </td>\n    </tr>\n    <tr>\n      <td>\n        <textarea cols="40" style="text-align: center;" class="signature"></textarea>\n      </td>\n    </tr>\n  </table>\n</div>')}function sourceSheets(el){var del=el.parents(".car-tabel").find(".on").val().slice("\\")[2]||0,printSheet=eval(el.parents(".car-tabel").find(".printSheet").val())||0,res=printSheet/del;isInteger(res)||(res=Math.ceil(res.toFixed(2))),el.parents(".car-tabel").find(".allSheet").val(res)}function isInteger(t){return(0^t)===t}function removeCar(){var t=$(".car-container");t.length>1&&t.last().remove()}function statusManager(){$(".status").each(function(){"prepress"===$(this).data("status")&&$(this).addClass("danger"),"citipi"===$(this).data("status")&&$(this).addClass("warning"),"keeper"===$(this).data("status")&&$(this).addClass("info"),"production"===$(this).data("status")&&$(this).addClass("active"),"success"===$(this).data("status")&&$(this).addClass("success")})}function ajaxSelect(t,e,a){t.select2({placeholder:e,ajax:{url:"/getCollection",dataType:"json",data:function(t){return{term:t.term,collection:a}},processResults:function(t){return{results:$.map(t,function(t){return{text:t.name,id:t.name}})}}}})}function addPrice(){return'<div class="col-md-3 form-price">  <div class="form-group">    <div class="col-md-4">      <label class="control-label">Название</label>    </div>    <div class="col-md-8">      <input type="text" required="required" class="form-control price-name"/>    </div>  </div>  <div class="form-group">    <div class="col-md-4">      <label class="control-label">Сумма</label>    </div>    <div class="col-md-8">      <input type="number" min="0" required="required" class="form-control price-number"/>    </div>  </div></div>'}function checkbox(){$(".production-status").each(function(){$(this).data("productionstatus")===$(this).val()&&($(this).prop("checked",!0),$(this).attr("disabled","disabled"))})}function clickCheckbox(){$(".status-check").each(function(){var t=$(this).find(".production-status");t.click(function(){t.prop("checked",!1),$(this).prop("checked",!0)})})}function changeStatus(t){var e=$(".production-status"),a=e.parents("tr").find(".passport-number").text();e.click(function(n){var o=confirm("Вы действительно хотите паспорту № "+a+" присвоить статус "+$(this).data("name")),s=$(this);if(o){$(this).parents(".status").find(e).removeAttr("disabled","disabled"),$(this).attr("disabled","disabled");var c=$(this).parents("tr").data("id");t.emit("valStatus",{status:$(this).val(),passportId:c,name:$(this).data("name")},function(t){412===t.status?Snackbar.show({text:t.msg,pos:"top-center",actionText:null}):(Snackbar.show({text:t.msg,pos:"top-center",actionText:null}),s.parents(".status").data("status",s.val()),"Исполнен"===s.data("name")&&s.parents("tr").hide("fast"))})}else n.preventDefault(),n.stopPropagation()})}function remove(t,e){var a=e.attr("id");$.ajax({type:"DELETE",url:t,data:{id:a},success:function(){e.parent().parent().hide()},error:function(t){Snackbar.show({text:t.responseText,pos:"bottom-left",actionText:null})}})}function changeStatusKeeper(t){var e=$(".production-podstatus"),a=e.parents("tr").find(".passport-number").text();e.click(function(n){var o=confirm("Вы действительно хотите паспорту № "+a+" присвоить статус "+$(this).data("name")),s=$(this);if(o){$(this).parents(".status").find(e).removeAttr("disabled","disabled"),$(this).attr("disabled","disabled");var c=$(this).parents("tr").data("id");t.emit("valPodStatus",{podstatus:$(this).val(),passportId:c},function(t){412===t.status?Snackbar.show({text:t.msg,pos:"top-center",actionText:null}):(Snackbar.show({text:t.msg,pos:"top-center",actionText:null}),s.parents(".status").data("status",s.val()),s.parents(".hider").hide("fast"))})}else n.preventDefault(),n.stopPropagation()})}function checkboxKeeper(){$(".production-podstatus").each(function(){$(this).data("status")===$(this).val()&&($(this).prop("checked",!0),$(this).attr("disabled","disabled"))})}function clickCheckboxKeeper(){$(".status-check").each(function(){var t=$(this).find(".production-podstatus");t.click(function(){t.prop("checked",!1),$(this).prop("checked",!0)})})}$(function(){$(document).on("click",".addPapers",function(){var t={typePaperId:$(".stockTypePaper").val(),typePaper:$(".stockTypePaper :selected").text(),grammPaperId:$(".stockGrammPaper").val(),grammPaper:$(".stockGrammPaper :selected").text(),sizePaperId:$(".stockSizePaper").val(),sizePaper:$(".stockSizePaper :selected").text(),count:+$(".stockPaperCount").val()},e=!1;null===t.count||void 0===t.count||""===t.count||t.count<0?(Snackbar.show({text:"Неверное значение кол-ва бумаги",pos:"top-center",actionText:null}),e=!1):null===t.sizePaperId||void 0===t.sizePaperId?(Snackbar.show({text:"Выбирете формат бумаги",pos:"top-center",actionText:null}),e=!1):null===t.grammPaperId||void 0===t.grammPaperId?(Snackbar.show({text:"Выбирете граммаж бумаги",pos:"top-center",actionText:null}),e=!1):null===t.typePaperId||void 0===t.typePaperId?(Snackbar.show({text:"Выбирете тип бумаги",pos:"top-center",actionText:null}),e=!1):e=!0,console.log(e),e&&socket.emit("addPaper",t,function(t){412===t.status?Snackbar.show({text:t.msg,pos:"top-center",actionText:null}):window.location.reload()})}),$(document).on("click",".removePapers",function(){var t={typePaperId:$(".stockTypePaper").val(),grammPaperId:$(".stockGrammPaper").val(),sizePaperId:$(".stockSizePaper").val(),count:+$(".stockPaperCount").val()},e=!1;null===t.count||void 0===t.count||""===t.count||t.count<0?(Snackbar.show({text:"Неверное значение кол-ва бумаги",pos:"top-center",actionText:null}),e=!1):null===t.sizePaperId||void 0===t.sizePaperId?(Snackbar.show({text:"Выбирете формат бумаги",pos:"top-center",actionText:null}),e=!1):null===t.grammPaperId||void 0===t.grammPaperId?(Snackbar.show({text:"Выбирете граммаж бумаги",pos:"top-center",actionText:null}),e=!1):null===t.typePaperId||void 0===t.typePaperId?(Snackbar.show({text:"Выбирете тип бумаги",pos:"top-center",actionText:null}),e=!1):e=!0,e&&socket.emit("removePaper",t,function(t){412===t.status?Snackbar.show({text:t.msg,pos:"top-center",actionText:null}):window.location.reload()})}),$(document).on("click","#status-paper",function(){var t={_id:$(this).parents(".block-paper").data("id").replace(/"/g,""),status:"order"};socket.emit("change-status-order-paper",t,function(t){200===t.status?(Snackbar.show({text:t.msg,pos:"top-center",actionText:null}),window.location.reload()):Snackbar.show({text:t.msg,pos:"top-center",actionText:null})})})}),$(function(){var t=$(".add-btn"),e=$(".cancel-btn"),a=$(".save-btn"),n=$(".row-papper"),o=$(".removeRow");$(".text").on("select2:select",function(t){var e=t.params.data.element,a=$(e);a.detach(),$(this).append(a),$(this).trigger("change")}),n.hide(),t.click(function(){btnHide(n,e,a,$(this))}),e.click(function(){btnShow(n,t,a,$(this))}),a.click(function(){sandData($("#type-papper"))}),o.click(function(){if(!confirm("Вы действительно хотите удалить "+$(this).data("name")+"?"))return!1;removeRow($(this))}),$(document).on("click",".close",function(){$(".permiss").length>1&&$(this).parents(".permiss").remove()}),$(document).on("click","#addPermissions",function(){$(this).before('<div class="row permiss">\n  <div class="col-md-6">\n    <button type="button" data-dismiss="alert" class="close">×</button>\n    <div class="col-md-6">\n      <div class="form-group label-floating">\n        <label class="control-label">Url</label>\n        <input type="text" required class="form-control name"/>\n      </div>\n    </div>\n    <div class="col-md-6">\n      <div class="form-group label-floating">\n        <label class="control-label">Доступ</label>\n        <select class="form-control access" required>\n          <option value="1" selected="selected">Чтение</option>\n          <option value="2">Чтение/Запись</option>\n          <option value="3">Чтение/Запись/Удаление</option>\n        </select>\n      </div>\n    </div>\n  </div>\n</div>'),$(".access").select2()})}),$(function(){$("#history").select2();var t=$(".history-body");$(".subtable-history");$(document).on("change","#history",function(){var e={passportId:$(this).val()};socket.emit("history",e,function(e){412===e.status?Snackbar.show({text:e.msg,pos:"top-center",actionText:null}):(t.empty(),e.history.forEach(function(e,a){var n=new Date(e.date),o=n.getFullYear()+"."+("0"+(n.getMonth()+1)).slice(-2)+"."+("0"+n.getDate()).slice(-2);t.append('<tr class="tr"><td>'+o+"</td><td>"+e.manager+"</td><td>"+e.meta+"</td></tr>");var s=$(".tr").last();e.price.forEach(function(t){s.append('<table class="table table-bordered"><thead><th>Название</th><th>Цена</th></thead><tbody></tbody><tr><td>'+t.name+"</td><td>"+t.number+"р.</td></tr></table>")})}))})})}),$(function(){var t=$("#add-customer"),e=$("#remove-customer"),a=$("#add-name"),n=$("#remove-name"),o=$("#car-add"),s=$("#car-remove"),c=$(".passport-date"),i=$(".passport-id"),r=$(".passport-customer"),l=$(".passport-number"),d=$(".passport-manager"),p=$(".passport-paper"),u=$(".passport-density"),m=$(".passport-circulation"),h=$(".passport-color"),v=$(".passport-sheet"),f=$("#searchDate"),x=$("#searchId"),b=$("#searchCustomer"),k=$("#searchManager"),y=$("#paper"),g=$("#number"),B=$("#density"),S=$("#circulation"),P=$("#color"),w=$("#sheet"),T=$('select:not(".not-select"):not("#history")'),z=window.location;$('ul.nav a[href="'+z+'"]').parent().addClass("active"),$("ul.nav a").filter(function(){return this.href==z}).parent().addClass("active"),$.material.init(),$('input[type="tel"]').mask("+7(999) 999-9999"),statusManager(),T.select2(),$(".text").select2({tags:!0,tokenSeparators:[","," "]}),$(".size-paper").select2({});var C=[];$(".box").click(function(){C.push($(this).text()+"; "),$(".resultBox").last().append('<div class="childrenBox" contenteditable="true"><button type="button" class="close closeBox">×</button><div class="textBox">'+$(this).text()+"</div></div>")}),ajaxSelect($(".typePaper"),"Тип","typepappers"),ajaxSelect($(".typePaperGramm"),"Граммаж","grammpappers"),ajaxSelect($(".typePaperSize"),"Размер","sizepappers"),ajaxSelect($("#manager"),"Менеджер","users"),$(document).on("click",".addBox",function(t){$(".set-modal-body").append('<div class="carBox"><button type="button" class="close closeCarBox">×</button><h4 class="modal-title">Значения для машины</h4><div class="resultBox"></div></div>')}),$(document).on("click",".childrenBox",function(){$(this).parents(".childrenBox").text()}),$(document).on("click",".closeBox",function(){$(this).parents(".childrenBox").remove()}),$(document).on("click",".closeCarBox",function(){$(this).parent().remove()}),$(".resultButton").click(function(){var t="";$(".resultBox").length>1?(t="",$(".resultBox").each(function(){$(this).find(".textBox").each(function(){t+=$(this).text()+"; "}),t+="//"}),t=t.substring(0,t.length-2)):$(".resultBox").each(function(){t="",$(this).find(".textBox").each(function(){t+=$(this).text()+"; "})}),$("#myModal").modal("toggle"),$(".set").val(t)}),$(".addSet").click(function(){$(".carBox").remove();for(var t=$(".set").val().split("//"),e="",a=0;a<t.length;a++)$(".set-modal-body").append('<div class="carBox"><button type="button" class="close closeCarBox">×</button><h4 class="modal-title">Значения для машины</h4><div class="resultBox"></div></div>');$(".carBox").each(function(a,n){e=t[a].split("; "),e=_.compact(e);var o=$(this);e.forEach(function(t){o.find(".resultBox").append('<div class="childrenBox" contenteditable="true"><button type="button" class="close closeBox">×</button><div class="textBox">'+t+"</div></div>")})})});$(".boxD").click(function(){C.push($(this).text()+"; "),$(".resultBoxD").last().append('<div class="childrenBoxD" contenteditable="true"><button type="buttonD" class="close closeBoxD">×</button><div class="textBoxD">'+$(this).text()+"</div></div>")}),$(document).on("click",".addBoxD",function(t){$(".decoration-modal").append('<div class="carBoxD"><button type="button" class="close closeCarBox">×</button><h4 class="modal-title">Значения для машины</h4><div class="resultBoxD"></div></div>')}),$(document).on("click",".childrenBoxD",function(){$(this).parents(".childrenBoxD").text()}),$(document).on("click",".closeBoxD",function(){$(this).parents(".childrenBoxD").remove()}),$(document).on("click",".closeCarBoxD",function(){$(this).parent().remove()}),$(".resultButtonDecoration").click(function(){var t="";$(".resultBoxD").length>1?(t="",$(".resultBoxD").each(function(){$(this).find(".textBoxD").each(function(){t+=$(this).text()+"; "}),t+="//"}),t=t.substring(0,t.length-2)):$(".resultBoxD").each(function(){t="",$(this).find(".textBoxD").each(function(){t+=$(this).text()+"; "})}),$("#modalDecoration").modal("toggle"),$(".decoration").val(t)}),$(".addSetD").click(function(){$(".carBoxD").remove();for(var t=$(".decoration").val().split("//"),e="",a=0;a<t.length;a++)$(".decoration-modal").append('<div class="carBoxD"><button type="button" class="close closeCarBoxD">×</button><h4 class="modal-title">Значения для машины</h4><div class="resultBoxD"></div></div>');$(".carBoxD").each(function(a,n){e=t[a].split("; "),e=_.compact(e);var o=$(this);e.forEach(function(t){o.find(".resultBoxD").append('<div class="childrenBoxD" contenteditable="true"><button type="button" class="close closeBoxD">×</button><div class="textBoxD">'+t+"</div></div>")})})}),T.on("select2:select",function(t){var e=t.params.data.element,a=$(e);a.detach(),$(this).append(a),$(this).trigger("change")}),$("#noFile").click(function(){$(this).prop("checked")?$("#file").removeAttr("disabled"):$("#file").attr("disabled","disabled")}),t.click(function(){addCustomer()}),e.click(function(){removeCustomer()}),a.click(function(){addName()}),n.click(function(){removeName()});var D=$("#timeCheck"),G=$("#timeInput");D.click(function(){$(this).prop("checked")?G.removeAttr("disabled"):G.attr("disabled","disabled")}),o.click(function(){addCar(),ajaxSelect($(".typePaper"),"Тип","typepappers"),ajaxSelect($(".typePaperGramm"),"Граммаж","grammpappers"),ajaxSelect($(".typePaperSize"),"Размер","sizepappers"),ajaxSelect($("#manager"),"Менеджер","users")}),s.click(function(){removeCar()}),$(document).on("change",".on, .printSheet",function(){sourceSheets($(this))}),$("#file").change(function(){var t=$(this).val(),e=t.split("\\");t=t.replace(e[e.length-1],""),$("#fullPath").html(t)});var I=$('input[name="delivery"]'),q=$(".type-delever"),j=$('input[name="type-delivery"]'),E=$(".bus"),A=$(".delivery-address"),Y=$(".address");E.hide(),A.hide(),q.hide(),"Доставка"===$('input[name="delivery"]:checked').val()?q.show():(q.hide(),j.prop("checked",!1),Y.val(""),A.hide(),E.hide());var M=$('input[name="type-delivery"]:checked').val();"Автобус"===M||void 0==M?(E.show(),A.hide(),Y.val("")):(A.show(),E.hide()),I.on("change",function(){"Доставка"===$('input[name="delivery"]:checked').val()?q.show():(q.hide(),j.prop("checked",!1),Y.val(""),A.hide(),E.hide())}),j.on("change",function(){"Автобус"===$('input[name="type-delivery"]:checked').val()?(E.show(),A.hide(),Y.val("")):(A.show(),E.hide())}),f.keyup(function(){searchPassports($(this).val(),c)}),g.keyup(function(){searchPassports($(this).val(),l)}),x.keyup(function(){searchPassports($(this).val(),i)}),b.keyup(function(){searchPassports($(this).val(),r)}),k.keyup(function(){searchPassports($(this).val(),d)}),y.keyup(function(){searchPassports($(this).val(),p)}),B.keyup(function(){searchPassports($(this).val(),u)}),S.keyup(function(){searchPassports($(this).val(),m)}),P.keyup(function(){searchPassports($(this).val(),h)}),w.keyup(function(){searchPassports($(this).val(),v)}),"/"===window.location.pathname?$(".chat").show():$(".chat").hide(),$(".patter").each(function(){$(this).keyup(function(){var t=$(this).val(),e=/[!@#$%^&*()_\\;,."']/i.test(t);e&&(e=t.replace(/[!@#$%^&*()_\\;,."']/i,""),e&&Snackbar.show({text:"Записи разделаются только пробелом!",pos:"top-center",actionText:null}),$(this).val(e))})}),$("#print").click(function(){window.print()})});var mas=[];$(document).on("select2:select","#grammpapper",function(t){mas.push(t.params.data.text+"; "),$(".resultBoxGramm").last().append('<div class="childrenBoxGramm" contenteditable="true"><button type="button" class="close closeBoxGramm">×</button><div class="textBoxGramm">'+t.params.data.text+"</div></div>")}),$(document).on("click",".addBoxGramm",function(t){$(".gramm-modal-body").append('<div class="carBoxGramm"><button type="button" class="close closeCarBoxGramm">×</button><h4 class="modal-title">Значения для машины</h4><div class="resultBoxGramm"></div></div>')}),$(document).on("click",".childrenBoxGramm",function(){$(this).parents(".childrenBoxGramm").text()}),$(document).on("click",".closeBoxGramm",function(){$(this).parents(".childrenBoxGramm").remove()}),$(document).on("click",".closeCarBoxGramm",function(){$(this).parent().remove()}),$(document).on("click",".resultButtonGramm",function(){var t="";$(".resultBoxGramm").length>1?(t="",$(".resultBoxGramm").each(function(){$(this).find(".textBoxGramm").each(function(){t+=$(this).text()+"; "}),t+="//"}),t=t.substring(0,t.length-2)):$(".resultBoxGramm").each(function(){t="",$(this).find(".textBoxGramm").each(function(){t+=$(this).text()+"; "})}),$("#modalGramm").modal("toggle"),$(".typePaperGramm").val(t)}),$(document).on("click",".addSetGramm",function(){$(".carBoxGramm").remove();for(var t=$(".typePaperGramm").val().split("//"),e="",a=0;a<t.length;a++)$(".gramm-modal-body").append('<div class="carBoxGramm"><button type="button" class="close closeCarBoxGramm">×</button><h4 class="modal-title">Значения для машины</h4><div class="resultBoxGramm"></div></div>');$(".carBoxGramm").each(function(a,n){e=t[a].split("; "),e=_.compact(e);var o=$(this);e.forEach(function(t){o.find(".resultBoxGramm").append('<div class="childrenBoxGramm" contenteditable="true"><button type="button" class="close closeBoxGramm">×</button><div class="textBoxGramm">'+t+"</div></div>")})})});var mas=[];$(document).on("select2:select","#sizepapper",function(t){mas.push(t.params.data.text+"; "),$(".resultBoxSize").last().append('<div class="childrenBoxSize" contenteditable="true"><button type="button" class="close closeBoxSize">×</button><div class="textBoxSize">'+t.params.data.text+"</div></div>")}),$(document).on("click",".addBoxSize",function(t){$(".size-modal-body").append('<div class="carBoxSize"><button type="button" class="close closeCarBoxSize">×</button><h4 class="modal-title">Значения для машины</h4><div class="resultBoxSize"></div></div>')}),$(document).on("click",".childrenBoxSize",function(){$(this).parents(".childrenBoxSize").text()}),$(document).on("click",".closeBoxSize",function(){$(this).parents(".childrenBoxSize").remove()}),$(document).on("click",".closeCarBoxSize",function(){$(this).parent().remove()}),$(document).on("click",".resultButtonSize",function(){var t="";$(".resultBoxSize").length>1?(t="",$(".resultBoxSize").each(function(){$(this).find(".textBoxSize").each(function(){t+=$(this).text()+"; "}),t+="//"}),t=t.substring(0,t.length-2)):$(".resultBoxSize").each(function(){t="",$(this).find(".textBoxSize").each(function(){t+=$(this).text()+"; "})}),$("#modalSize").modal("toggle"),$(".typePaperSize").val(t)}),$(document).on("click",".addSetSize",function(){$(".carBoxSize").remove();for(var t=$(".typePaperSize").val().split("//"),e="",a=0;a<t.length;a++)$(".size-modal-body").append('<div class="carBoxSize"><button type="button" class="close closeCarBoxSize">×</button><h4 class="modal-title">Значения для машины</h4><div class="resultBoxSize"></div></div>');$(".carBoxSize").each(function(a,n){e=t[a].split("; "),e=_.compact(e);var o=$(this);e.forEach(function(t){o.find(".resultBoxSize").append('<div class="childrenBoxSize" contenteditable="true"><button type="button" class="close closeBoxSize">×</button><div class="textBoxSize">'+t+"</div></div>")})})});var mas=[];$(document).on("select2:select","#typepapper",function(t){mas.push(t.params.data.text+"; "),$(".resultBoxType").last().append('<div class="childrenBoxType" contenteditable="true"><button type="button" class="close closeBoxType">×</button><div class="textBoxType">'+t.params.data.text+"</div></div>")}),$(document).on("click",".addBoxType",function(t){$(".type-modal-body").append('<div class="carBoxType"><button type="button" class="close closeCarBoxType">×</button><h4 class="modal-title">Значения для машины</h4><div class="resultBoxType"></div></div>')}),$(document).on("click",".childrenBoxType",function(){$(this).parents(".childrenBoxType").text()}),$(document).on("click",".closeBoxType",function(){$(this).parents(".childrenBoxType").remove()}),$(document).on("click",".closeCarBoxType",function(){$(this).parent().remove()}),$(document).on("click",".resultButtonType",function(){var t="";$(".resultBoxType").length>1?(t="",$(".resultBoxType").each(function(){$(this).find(".textBoxType").each(function(){t+=$(this).text()+"; "}),t+="//"}),t=t.substring(0,t.length-2)):$(".resultBoxType").each(function(){t="",$(this).find(".textBoxType").each(function(){t+=$(this).text()+"; "})}),$("#modalType").modal("toggle"),$(".typePaper").val(t)}),$(document).on("click",".addSetType",function(){$(".carBoxType").remove();var t=$(".typePaper").val().split("//"),e="";console.log(t);for(var a=0;a<t.length;a++)$(".type-modal-body").append('<div class="carBoxType"><button type="button" class="close closeCarBoxType">×</button><h4 class="modal-title">Значения для машины</h4><div class="resultBoxType"></div></div>');$(".carBoxType").each(function(a,n){e=t[a].split("; "),e=_.compact(e);var o=$(this);e.forEach(function(t){o.find(".resultBoxType").append('<div class="childrenBoxType" contenteditable="true"><button type="button" class="close closeBoxType">×</button><div class="textBoxType">'+t+"</div></div>")})})}),$(function(){$(document).on("click","#price-add",function(){$(".form-price").last().after(addPrice())}),$(document).on("click","#price-remove",function(){console.log(23);var t=$(".form-price");t.length>1&&t.last().remove()})}),$(function(){var t=$(".remove"),e=io();t.click(function(){if(!confirm("Вы действительно хотите удалить "+$(this).data("name")+"?"))return!1;remove("/production/"+$(this).attr("id"),$(this))}),checkbox(),clickCheckbox(),changeStatus(e)}),$(function(){$("#report").click(function(){var t={managers:$("#managers-name").val(),startDate:$("#start-date").val(),endDate:$("#end-date").val()};if(!t.managers)return!1;socket.emit("report",t,function(t){if(412===t.status)Snackbar.show({text:t.msg,pos:"top-center",actionText:null});else if($(".report").empty(),t.report.length){var e=0;t.report.forEach(function(t){$(".report").append("<tr><td>"+t._id+"</td><td>"+t.price+"</td></tr>"),e+=t.price}),$(".report").append("<tr><td><b>Итого</b></td><td><b>"+e+"</b></td></tr>")}})})}),$(function(){var t=($("#savePassportBtn"),$("#formPassport")),e=io();e.on("updatePassport",function(t){Snackbar.show({text:t,pos:"top-center",actionText:"OK",duration:null})}),t.on("submit",function(t){var a={};a.sizePaper=[],a.typePaper=[],a.typePaperSize=[],a.typePaperGramm=[],a.decoration=[],a.manager=[],a.allCar=[],a.passOn=$(".pass-on").val()||"",a.timePassport=$(".time").val()||"",a.contactPerson=$(".contact-person").val()||"",a.phone=$(".phone").val()||"",a.customer=$(".customer").val()||"",a.name=$(".name").val()||"",a.circulationFiled=$(".circulation").val()||"",a.page=$(".page").val()||"",a.redness=$(".redness").val()||"",a.file=$(".fileText").val()||"",a.comment=$(".comment").val()||"",a.address=$(".address").val()||"",a.date=moment().format("DD.MM.YYYY")||"",a.timeSave=moment().format("hh:mm")||"",a.passportId=moment().format("DDMMYYYY")||"",a.deliveryFiled=$('input[name="delivery"]:checked').val()||"",a.typeDeliveryFiled=$('input[name="type-delivery"]:checked').val()||"",a.sizePaper=[],$(".itemPaper").map(function(){a.sizePaper.push($(this).text())}),a.typePaperSize=$(".typePaperSize").val()||"",a.typePaperGramm=$(".typePaperGramm").val()||"",a.set=$(".set").val()||"",a.decoration=$(".decoration").val()||"",a.manager=$(".manager").val()||[],a.managerId=$("#managerId").val(),a.status="new",a.createdAt=new Date,a.priceArray=[];var n=0;$(".form-price").each(function(){var t={};t.name=$(this).find(".price-name").val(),t.number=+$(this).find(".price-number").val(),a.priceArray.push(t),n+=t.number});var o={meta:"Создано",manager:a.manager[0]||"",price:a.priceArray};if(a.price=n,!a.sizePaper.length)return Snackbar.show({text:"Размер бумаги не выбран!",pos:"top-center"}),!1;$(".car-container").each(function(){var t={};t.typePaper=$(this).find(".typePaper").val(),t.grammPaper=$(this).find(".typePaperGramm").val(),t.sizePaper=$(this).find(".typePaperSize").val(),t.commentTop=$(this).find(".comment-top").val(),t.car=$(this).find(".car-select").val(),t.sht=$(this).find(".Sht").val(),t.on=$(this).find(".on").val(),t.printSheet=$(this).find(".printSheet").val(),t.allSheet=$(this).find(".allSheet").val(),t.signature=$(this).find(".signature").val(),a.allCar.push(t)});var s=!0;return e.emit("savePassportBtn",a,o,function(t){412===t.status?(Snackbar.show({text:t.msg,pos:"top-center",actionText:null}),s=!1):s=!0}),!!s&&void 0}),$("#updatePassportBtn").on("click",function(t){var a={};a.sizePaper=[],a.typePaper=[],a.typePaperSize=[],a.typePaperGramm=[],a.decoration=[],a.manager=[],a.allCar=[],a.passOn=$(".pass-on").val()||"",a.timePassport=$(".time").val()||"",a.contactPerson=$(".contact-person").val()||"",a.phone=$(".phone").val()||"",a.customer=$(".customer").val()||"",a.name=$(".name").val()||"",a.circulationFiled=$(".circulation").val()||"",a.page=$(".page").val()||"",a.redness=$(".redness").val()||"",a.file=$(".fileText").val()||"",a.comment=$(".comment").val()||"",a.address=$(".address").val()||"",a.date=moment().format("DD.MM.YYYY")||"",a.timeSave=moment().format("hh:mm")||"",a.passportId=$(".passportId").text(),a.deliveryFiled=$('input[name="delivery"]:checked').val()||"",a.typeDeliveryFiled=$('input[name="type-delivery"]:checked').val()||"",a.sizePaper=[],$(".itemPaper").map(function(){a.sizePaper.push($(this).text())}),a.typePaper=$(".typePaper").val()||"",a.typePaperSize=$(".typePaperSize").val()||"",a.typePaperGramm=$(".typePaperGramm").val()||"",a.set=$(".set").val()||"",a.decoration=$(".decoration").val()||"",a.manager=$(".manager").val()||[],a.managerId=$(".managerId").val(),a.userUpdate=$(".userName").text(),a.updatedAt=new Date,a.managerCreated=new Date,a.priceArray=[];var n=0;$(".form-price").each(function(){var t={};t.name=$(this).find(".price-name").val(),t.number=+$(this).find(".price-number").val(),a.priceArray.push(t),n+=t.number});var o={meta:"Обновлено",manager:a.manager[0]||"",price:a.priceArray,passportId:a.passportId};if(a.price=n,!a.sizePaper.length)return Snackbar.show({text:"Размер бумаги не выбран!",pos:"top-center"}),!1;$(".car-container").each(function(){var t={};t.typePaper=$(this).find(".typePaper").val(),t.grammPaper=$(this).find(".typePaperGramm").val(),t.sizePaper=$(this).find(".typePaperSize").val(),t.commentTop=$(this).find(".comment-top").val(),t.car=$(this).find(".car-select").val(),t.sht=$(this).find(".Sht").val(),t.on=$(this).find(".on").val(),t.printSheet=$(this).find(".printSheet").val(),t.allSheet=$(this).find(".allSheet").val(),t.signature=$(this).find(".signature").val(),a.allCar.push(t)});var s=window.location.pathname.split("/")[3],c=!0;return e.emit("updatePassportBtn",{data:a,id:s,priceLog:o},function(t){if(412===t.status)Snackbar.show({text:t.msg,pos:"top-center",actionText:null}),c=!1;else if(201===t.status){var n="";t.arr.forEach(function(t){n+="На складе не хватает бумаги тип: "+t.typePaper+" граммаж: "+t.grammPaper+" формат: "+t.sizePaper+" "+t.count+" штук.\n"});var o=confirm(n+"Хотите оставить заявку?");if(o){var s={order:t.arr,person:a.manager[0]};e.emit("stockOrder",s,function(t){window.location.replace("/manager/orderpapers")})}c=!0}else Snackbar.show({text:t.msg,pos:"top-center",actionText:null}),c=!0}),!!c&&void 0})}),$(function(){var t=$("#profileUpdate"),e={};t.click(function(){e.name=$("#name").val(),$.ajax({url:"/manager/profile",type:"post",data:e,success:function(t){Snackbar.show({text:"Данные успешно сохраненны!",pos:"bottom-left",actionText:null})},error:function(t){Snackbar.show({text:"Что-то пошло не так!",pos:"bottom-left",actionText:null})}})})}),$(function(){$("#saveUser").click(function(){var t={};t.email=$('input[name="email"]').val(),t.role=$("#role").val(),t.name=$("#name").val(),
t.nameRole=$("#role option:selected").text();var e=[];$(".permiss").each(function(){var t={};t.name=$(this).find(".name").val(),t.access=+$(this).find(".access").val(),t.group=$(this).find(".name option:selected").text(),e.push(t)}),t.permissions=e,$.ajax({type:"POST",data:{data:JSON.stringify(t)},success:function(t){Snackbar.show({text:"Данные успешно сохраненны!",pos:"bottom-left",actionText:null})},error:function(t){Snackbar.show({text:"Что-то пошло не так! "+t,pos:"bottom-left",actionText:null})}})})}),$(function(){var t=$(".size-paper");t.change(function(e){$(".size-paper-input").append('<div class="itemPaper">'+$(this).val()+"</div>"),t.prop("selectedIndex",0)}),$(document).on("click",".itemPaper",function(){$(this).remove()})});var socket=io.connect();$(function(){var t=$("#prepress-sent"),e=$("#citipi-sent"),a=$("#storekeeper-sent"),n=$("#saveCommentPrepress");socket.on("prepress-status",function(t){Snackbar.show({text:t,pos:"top-center",actionText:null})}),socket.on("citipi-status",function(t){Snackbar.show({text:t,pos:"top-center",actionText:null})}),socket.on("storekeeper-status",function(t){Snackbar.show({text:t,pos:"top-center",actionText:null})}),socket.on("success-status",function(t){Snackbar.show({text:t,pos:"top-center",actionText:null})}),socket.on("production-status",function(t){Snackbar.show({text:t,pos:"top-center",actionText:null})}),t.click(function(){confirm("Вы уверены что хотите отправить этот паспорт допечатнику?")&&socket.emit("prepress",$(this).data("id"),function(t){200===t.status?(Snackbar.show({text:t.msg,pos:"top-center",actionText:null}),document.location.href="/manager/allpassport"):Snackbar.show({text:t.msg,pos:"top-center",actionText:null})})}),e.click(function(){confirm("Вы уверены что хотите отправить этот паспорт СиТиПи?")&&(console.log($(".userName").text()),socket.emit("citipi",$(this).data("id"),$(".userName").text(),function(t){200===t.status?(Snackbar.show({text:t.msg,pos:"top-center",actionText:null}),document.location.href="/prepress"):Snackbar.show({text:t.msg,pos:"top-center",actionText:null})}))}),a.click(function(){confirm("Вы уверены что хотите отправить этот паспорт на склад?")&&socket.emit("storekeeper",$(this).data("id"),function(t){200===t.status?(Snackbar.show({text:t.msg,pos:"top-center",actionText:null}),document.location.href="/citipi"):Snackbar.show({text:t.msg,pos:"top-center",actionText:null})})}),n.click(function(){var t={};t.id=$(this).data("id"),t.prepressComment=$("#commentPrep").val(),socket.emit("saveCommentPrepress",t,function(t){Snackbar.show({text:t.msg,pos:"top-center",actionText:null})})})}),$(function(){changeStatusKeeper(io()),checkboxKeeper(),clickCheckboxKeeper()});