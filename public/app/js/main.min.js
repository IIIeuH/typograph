function btnHide(e,t,a,n){e.show(),t.removeClass("hidden"),a.removeClass("hidden"),n.addClass("hidden")}function btnShow(e,t,a,n){e.hide(),a.addClass("hidden"),n.addClass("hidden"),t.removeClass("hidden")}function sandData(e){var t=e.val(),a=[];null!==t?(t.forEach(function(e){var t={};t.name=e,a.push(t)}),a=JSON.stringify(a),$.ajax({type:"PUT",data:{data:a},success:function(e){Snackbar.show({text:"Данные успешно сохраненны!",pos:"bottom-left",actionText:null}),window.location.reload()},error:function(e){Snackbar.show({text:"Что-то пошло не так!",pos:"bottom-left",actionText:null})}})):Snackbar.show({text:"Заполните поле!",pos:"top-center",actionText:"OK",actionTextColor:"#ff0000"})}function removeRow(e){var t=e.attr("id");$.ajax({type:"DELETE",data:{id:t},success:function(){e.parent().parent().hide()},error:function(){Snackbar.show({text:"Что-то пошло не так!",pos:"bottom-left",actionText:null})}})}function searchPassports(e,t){$.each(t,function(){var t=$(this).parent();~$(this).text().indexOf(e)||""===e?t.show():t.hide()})}function addCustomer(){var e=$(".customer-container");e.length<5&&(e.last().after('<div class="col-md-2 customer-container"><select multiple="multiple" class="form-control customerNumber"><option>Заказчик 1</option><option>Заказчик 2</option><option>Заказчик 3</option><option>Заказчик 4</option></select></div>'),$(".customerNumber").select2())}function removeCustomer(){var e=$(".customer-container");e.length>1&&e.last().remove()}function addName(){var e=$(".name-container");e.length<5&&(e.last().after('<div class="col-md-2 name-container"><select multiple="multiple" class="form-control name"><option>Наименование 1</option><option>Наименование 2</option><option>Наименование 3</option><option>Наименование 4</option></select></div>'),$(".name").select2())}function removeName(){var e=$(".name-container");e.length>1&&e.last().remove()}function addCar(){var e=$(".car-container");e.length<8&&e.last().after('<div class="car-container">\n  <table class="table table-bordered table-condensed car-tabel">\n    <tr>\n      <td>\n        <div class="row">\n          <div class="col-md-12">\n            <div class="form-group">\n              <label class="col-md-5 control-label">На машину</label>\n              <div class="col-md-7">\n                <select class="form-control car-select">\n                  <option>A2</option>\n                  <option>A3</option>\n                </select>\n              </div>\n            </div>\n          </div>\n        </div>\n        <div class="form-group">\n          <label class="col-md-5 control-label">Шт.</label>\n          <div class="col-md-7">\n            <input type="text" class="form-control Sht"/>\n          </div>\n        </div>\n        <div class="form-group">\n          <label class="col-md-5 control-label">На</label>\n          <div class="col-md-7">\n            <input type="text" class="form-control on"/>\n          </div>\n        </div>\n        <div class="form-group">\n          <label class="col-md-5 control-label">Печ. листов</label>\n          <div class="col-md-7">\n            <input type="text" class="form-control printSheet"/>\n          </div>\n        </div>\n        <div class="form-group">\n          <label class="col-md-5 control-label">Исходных листов</label>\n          <div class="col-md-7">\n            <input type="text" class="form-control allSheet"/>\n          </div>\n        </div>\n      </td>\n    </tr>\n    <tr>\n      <td>\n        <textarea cols="30" class="signature"></textarea>\n      </td>\n    </tr>\n  </table>\n</div>')}function sourceSheets(el){var del=el.parents(".car-tabel").find(".on").val().slice("\\")[2]||0,printSheet=eval(el.parents(".car-tabel").find(".printSheet").val())||0;el.parents(".car-tabel").find(".allSheet").val(printSheet/del)}function removeCar(){var e=$(".car-container");e.length>1&&e.last().remove()}$(function(){var e=$(".add-btn"),t=$(".cancel-btn"),a=$(".save-btn"),n=$(".row-papper"),o=$(".removeRow");$(".text").on("select2:select",function(e){var t=e.params.data.element,a=$(t);a.detach(),$(this).append(a),$(this).trigger("change")}),n.hide(),e.click(function(){btnHide(n,t,a,$(this))}),t.click(function(){btnShow(n,e,a,$(this))}),a.click(function(){sandData($("#type-papper"))}),o.click(function(){confirm("Вы действительно хотите удалить "+$(this).data("name")+"?")&&removeRow($(this))})}),$(function(){var e=$("#add-customer"),t=$("#remove-customer"),a=$("#add-name"),n=$("#remove-name"),o=$("#car-add"),r=$("#car-remove"),l=$(".passport-date"),c=$(".passport-id"),i=$("#searchDate"),s=$("#searchId"),d=$('select:not(".car-select")'),p=($("select.mult"),$('select:not(".size-paper")'),window.location);$('ul.nav a[href="'+p+'"]').parent().addClass("active"),$("ul.nav a").filter(function(){return this.href==p}).parent().addClass("active"),$.material.init(),$('input[type="tel"]').mask("+7(999) 999-9999"),d.select2(),$(".text").select2({tags:!0,tokenSeparators:[","," "]}),$(".size-paper").select2({tags:!0,tokenSeparators:[","," "]}),$("#noFile").click(function(){$(this).prop("checked")?$("#file").removeAttr("disabled"):$("#file").attr("disabled","disabled")}),$("#typepapper").select2({placeholder:"Тип",ajax:{url:"/getCollection",dataType:"json",data:function(e){return{term:e.term,collection:"typepappers"}},processResults:function(e){return{results:$.map(e,function(e){return{text:e.name,id:e.name}})}}}}),$("#grammpapper").select2({placeholder:"Граммаж",ajax:{url:"/getCollection",dataType:"json",data:function(e){return{term:e.term,collection:"grammpappers"}},processResults:function(e){return{results:$.map(e,function(e){return{text:e.name,id:e.name}})}}}}),$("#sizepapper").select2({placeholder:"Размер",ajax:{url:"/getCollection",dataType:"json",data:function(e){return{term:e.term,collection:"sizepappers"}},processResults:function(e){return{results:$.map(e,function(e){return{text:e.name,id:e.name}})}}}}),e.click(function(){addCustomer()}),t.click(function(){removeCustomer()}),a.click(function(){addName()}),n.click(function(){removeName()});var m=$("#timeCheck"),u=$("#timeInput");m.click(function(){$(this).prop("checked")?u.removeAttr("disabled"):u.attr("disabled","disabled")}),o.click(function(){addCar()}),r.click(function(){removeCar()}),$(document).on("change",".on, .printSheet",function(){sourceSheets($(this))}),$("#file").change(function(){var e=$(this).val(),t=e.split("\\");e=e.replace(t[t.length-1],""),$("#fullPath").html(e)});var v=$('input[name="delivery"]'),h=$(".type-delever"),f=$('input[name="type-delivery"]'),b=$(".bus"),y=$(".delivery-address"),g=$(".address");b.hide(),y.hide(),h.hide(),v.change(function(){"Доставка"===$('input[name="delivery"]:checked').val()?h.show():(h.hide(),f.prop("checked",!1),g.val(""),y.hide(),b.hide())}),f.change(function(){"Автобус"===$('input[name="type-delivery"]:checked').val()?(b.show(),y.hide(),g.val("")):(y.show(),b.hide())}),i.keyup(function(){searchPassports($(this).val(),l)}),s.keyup(function(){searchPassports($(this).val(),c)}),"/"===window.location.pathname?$(".chat").show():$(".chat").hide(),$(".patter").each(function(){$(this).keyup(function(){var e=$(this).val(),t=/[!@#$%^&*()_\/\\;,."']/i.test(e);t&&(t=e.replace(/[!@#$%^&*()_\/\\;,."']/i,""),t&&Snackbar.show({text:"Записи разделаются только пробелом!",pos:"top-center",actionText:null}),$(this).val(t))})})}),$(function(){var e=($("#savePassportBtn"),$("#formPassport")),t=io();e.on("submit",function(e){var a={};a.sizePaper=[],a.typePaper=[],a.typePaperSize=[],a.typePaperGramm=[],a.decoration=[],a.manager=[],a.passOn=$(".pass-on").val()||"",a.timePassport=$(".time").val()||"",a.contactPerson=$(".contact-person").val()||"",a.phone=$(".phone").val()||"",a.customer=$(".customer").val()||"",a.name=$(".name").val()||"",a.circulationFiled=$(".circulation").val()||"",a.page=$(".page").val()||"",a.redness=$(".redness").val()||"",a.file=$(".fileText").val()||"",a.comment=$(".comment").val()||"",a.address=$(".address").val()||"",a.date=moment().format("DD.MM.YYYY")||"",a.timeSave=moment().format("hh:mm")||"",a.passportId="k"+moment().format("DDMMYYYYhhmm")||"",a.deliveryFiled=$('input[name="delivery"]:checked').val()||"",a.typeDeliveryFiled=$('input[name="type-delivery"]:checked').val()||"",a.sizePaper=$(".size-paper").val()||[],a.typePaper=$(".typePaper").val()||[],a.typePaperSize=$(".typePaperSize").val()||[],a.typePaperGramm=$(".typePaperGramm").val()||[],a.set=$(".set").val()||[],a.decoration=$(".decoration").val()||[],a.manager=$(".manager").val()||[],t.emit("savePassportBtn",a),t.on("readySavePassport",function(e){412===e.status&&Snackbar.show({text:e.msg,pos:"top-center",actionText:null})})})});