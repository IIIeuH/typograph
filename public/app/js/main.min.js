function btnHide(e,t,a,n){e.show(),t.removeClass("hidden"),a.removeClass("hidden"),n.addClass("hidden")}function btnShow(e,t,a,n){e.hide(),a.addClass("hidden"),n.addClass("hidden"),t.removeClass("hidden")}function sandData(e){var t=e.val(),a=[];null!==t?(t.forEach(function(e){var t={};t.name=e,a.push(t)}),a=JSON.stringify(a),$.ajax({type:"PUT",data:{data:a},success:function(e){Snackbar.show({text:"Данные успешно сохраненны!",pos:"bottom-left",actionText:null}),window.location.reload()},error:function(e){Snackbar.show({text:"Что-то пошло не так!",pos:"bottom-left",actionText:null})}})):Snackbar.show({text:"Заполните поле!",pos:"top-center",actionText:"OK",actionTextColor:"#ff0000"})}function removeRow(e){var t=e.attr("id");$.ajax({type:"DELETE",data:{id:t},success:function(){e.parent().parent().hide()},error:function(){Snackbar.show({text:"Что-то пошло не так!",pos:"bottom-left",actionText:null})}})}function searchPassports(e,t){$.each(t,function(){var t=$(this).parent();~$(this).text().indexOf(e)||""===e?t.show():t.hide()})}function addCar(){var e=$(".car-container");e.length<8&&e.last().after('<div class="car-container">\n  <table class="table table-bordered table-condensed car-tabel">\n    <tr>\n      <td>\n        <div class="row">\n          <div class="col-md-12">\n            <div class="form-group">\n              <label class="col-md-5 control-label">На машину</label>\n              <div class="col-md-7">\n                <select class="form-control car-select" required>\n                  <option>A2</option>\n                  <option>A3</option>\n                </select>\n              </div>\n            </div>\n          </div>\n        </div>\n        <div class="form-group">\n          <label class="col-md-5 control-label">Шт.</label>\n          <div class="col-md-7">\n            <input type="text" class="form-control Sht" required/>\n          </div>\n        </div>\n        <div class="form-group">\n          <label class="col-md-5 control-label">На</label>\n          <div class="col-md-7">\n            <input type="text" class="form-control on" required/>\n          </div>\n        </div>\n        <div class="form-group">\n          <label class="col-md-5 control-label">Печ. листов</label>\n          <div class="col-md-7">\n            <input type="text" class="form-control printSheet" required/>\n          </div>\n        </div>\n        <div class="form-group">\n          <label class="col-md-5 control-label">Исходных листов</label>\n          <div class="col-md-7">\n            <input type="text" class="form-control allSheet" required/>\n          </div>\n        </div>\n      </td>\n    </tr>\n    <tr>\n      <td>\n        <textarea cols="30" class="signature"></textarea>\n      </td>\n    </tr>\n  </table>\n</div>')}function sourceSheets(el){var del=el.parents(".car-tabel").find(".on").val().slice("\\")[2]||0,printSheet=eval(el.parents(".car-tabel").find(".printSheet").val())||0,res=printSheet/del;isInteger(res)||(res=res.toFixed(2)),el.parents(".car-tabel").find(".allSheet").val(res)}function isInteger(e){return(0^e)===e}function removeCar(){var e=$(".car-container");e.length>1&&e.last().remove()}function status(){$(".status").each(function(){"new"===$(this).data("status")&&$(this).addClass("danger"),"work"===$(this).data("status")&&$(this).addClass("warning"),"print"===$(this).data("status")&&$(this).addClass("success")})}$(function(){var e=$(".add-btn"),t=$(".cancel-btn"),a=$(".save-btn"),n=$(".row-papper"),o=$(".removeRow");$(".text").on("select2:select",function(e){var t=e.params.data.element,a=$(t);a.detach(),$(this).append(a),$(this).trigger("change")}),n.hide(),e.click(function(){btnHide(n,t,a,$(this))}),t.click(function(){btnShow(n,e,a,$(this))}),a.click(function(){sandData($("#type-papper"))}),o.click(function(){if(!confirm("Вы действительно хотите удалить "+$(this).data("name")+"?"))return!1;removeRow($(this))}),$(document).on("click",".close",function(){$(".permiss").length>1&&$(this).parents(".permiss").remove()}),$(document).on("click","#addPermissions",function(){$(this).before('<div class="row permiss">\n  <div class="col-md-6">\n    <button type="button" data-dismiss="alert" class="close">×</button>\n    <div class="col-md-6">\n      <div class="form-group label-floating">\n        <label class="control-label">Url</label>\n        <input type="text" required class="form-control name"/>\n      </div>\n    </div>\n    <div class="col-md-6">\n      <div class="form-group label-floating">\n        <label class="control-label">Доступ</label>\n        <select class="form-control access" required>\n          <option value="1" selected="selected">Чтение</option>\n          <option value="2">Чтение/Запись</option>\n          <option value="3">Чтение/Запись/Удаление</option>\n        </select>\n      </div>\n    </div>\n  </div>\n</div>'),$(".access").select2()})}),$(function(){var e=$("#add-customer"),t=$("#remove-customer"),a=$("#add-name"),n=$("#remove-name"),o=$("#car-add"),s=$("#car-remove"),c=$(".passport-date"),i=$(".passport-id"),l=$(".passport-customer"),r=$(".passport-manager"),d=$("#searchDate"),u=$("#searchId"),p=$("#searchCustomer"),m=$("#searchManager"),v=$('select:not(".car-select")'),h=($("select.mult"),$('select:not(".size-paper")'),window.location);$('ul.nav a[href="'+h+'"]').parent().addClass("active"),$("ul.nav a").filter(function(){return this.href==h}).parent().addClass("active"),$.material.init(),$('input[type="tel"]').mask("+7(999) 999-9999"),v.select2(),$(".text").select2({tags:!0,tokenSeparators:[","," "]}),$(".size-paper").select2({tags:!0,tokenSeparators:[","," "]});var f=[];$(".box").click(function(){f.push($(this).text()+"; "),$(".resultBox").last().append('<div class="childrenBox" contenteditable="true"><button type="button" class="close closeBox">×</button><div class="textBox">'+$(this).text()+"</div></div>")}),$(document).on("click",".addBox",function(e){$(".set-modal-body").append('<div class="carBox"><button type="button" class="close closeCarBox">×</button><h4 class="modal-title">Значения для машины</h4><div class="resultBox"></div></div>')}),$(document).on("click",".childrenBox",function(){$(this).parents(".childrenBox").text()}),$(document).on("click",".closeBox",function(){$(this).parents(".childrenBox").remove()}),$(document).on("click",".closeCarBox",function(){$(this).parent().remove()}),$(".resultButton").click(function(){var e="";$(".resultBox").length>1?(e="",$(".resultBox").each(function(){$(this).find(".textBox").each(function(){e+=$(this).text()+"; "}),e+="//"}),e=e.substring(0,e.length-2)):$(".resultBox").each(function(){e="",$(this).find(".textBox").each(function(){e+=$(this).text()+"; "})}),$("#myModal").modal("toggle"),$(".set").val(e)}),$(".addSet").click(function(){$(".carBox").remove();for(var e=$(".set").val().split("//"),t="",a=0;a<e.length;a++)$(".set-modal-body").append('<div class="carBox"><button type="button" class="close closeCarBox">×</button><h4 class="modal-title">Значения для машины</h4><div class="resultBox"></div></div>');$(".carBox").each(function(a,n){t=e[a].split("; "),t=_.compact(t);var o=$(this);t.forEach(function(e){o.find(".resultBox").append('<div class="childrenBox" contenteditable="true"><button type="button" class="close closeBox">×</button><div class="textBox">'+e+"</div></div>")})})});$(".boxD").click(function(){f.push($(this).text()+"; "),$(".resultBoxD").last().append('<div class="childrenBoxD" contenteditable="true"><button type="buttonD" class="close closeBoxD">×</button><div class="textBoxD">'+$(this).text()+"</div></div>")}),$(document).on("click",".addBoxD",function(e){$(".decoration-modal").append('<div class="carBoxD"><button type="button" class="close closeCarBox">×</button><h4 class="modal-title">Значения для машины</h4><div class="resultBoxD"></div></div>')}),$(document).on("click",".childrenBoxD",function(){$(this).parents(".childrenBoxD").text()}),$(document).on("click",".closeBoxD",function(){$(this).parents(".childrenBoxD").remove()}),$(document).on("click",".closeCarBoxD",function(){$(this).parent().remove()}),$(".resultButtonDecoration").click(function(){var e="";$(".resultBoxD").length>1?(e="",$(".resultBoxD").each(function(){$(this).find(".textBoxD").each(function(){e+=$(this).text()+"; "}),e+="//"}),e=e.substring(0,e.length-2)):$(".resultBoxD").each(function(){e="",$(this).find(".textBoxD").each(function(){e+=$(this).text()+"; "})}),$("#modalDecoration").modal("toggle"),$(".decoration").val(e)}),$(".addSetD").click(function(){$(".carBoxD").remove();for(var e=$(".decoration").val().split("//"),t="",a=0;a<e.length;a++)$(".decoration-modal").append('<div class="carBoxD"><button type="button" class="close closeCarBoxD">×</button><h4 class="modal-title">Значения для машины</h4><div class="resultBoxD"></div></div>');$(".carBoxD").each(function(a,n){t=e[a].split("; "),t=_.compact(t);var o=$(this);t.forEach(function(e){o.find(".resultBoxD").append('<div class="childrenBoxD" contenteditable="true"><button type="button" class="close closeBoxD">×</button><div class="textBoxD">'+e+"</div></div>")})})}),v.on("select2:select",function(e){var t=e.params.data.element,a=$(t);a.detach(),$(this).append(a),$(this).trigger("change")}),$("#noFile").click(function(){$(this).prop("checked")?$("#file").removeAttr("disabled"):$("#file").attr("disabled","disabled")}),$("#typepapper").select2({allowClear:!0,placeholder:"Тип",ajax:{url:"/getCollection",dataType:"json",data:function(e){return{term:e.term,collection:"typepappers"}},processResults:function(e){return{results:$.map(e,function(e){return{text:e.name,id:e.name}})}}}}),$("#grammpapper").select2({allowClear:!0,placeholder:"Граммаж",ajax:{url:"/getCollection",dataType:"json",data:function(e){return{term:e.term,collection:"grammpappers"}},processResults:function(e){return{results:$.map(e,function(e){return{text:e.name,id:e.name}})}}}}),$("#sizepapper").select2({allowClear:!0,placeholder:"Размер",ajax:{url:"/getCollection",dataType:"json",data:function(e){return{term:e.term,collection:"sizepappers"}},processResults:function(e){return{results:$.map(e,function(e){return{text:e.name,id:e.name}})}}}}),$("#manager").select2({placeholder:"Менеджер",ajax:{url:"/getCollection",dataType:"json",data:function(e){return{term:e.term,collection:"users"}},processResults:function(e){return{results:$.map(e,function(e){return{text:e.name,id:e.name}})}}}}),e.click(function(){addCustomer()}),t.click(function(){removeCustomer()}),a.click(function(){addName()}),n.click(function(){removeName()});var x=$("#timeCheck"),b=$("#timeInput");x.click(function(){$(this).prop("checked")?b.removeAttr("disabled"):b.attr("disabled","disabled")}),o.click(function(){addCar()}),s.click(function(){removeCar()}),$(document).on("change",".on, .printSheet",function(){sourceSheets($(this))}),$("#file").change(function(){var e=$(this).val(),t=e.split("\\");e=e.replace(t[t.length-1],""),$("#fullPath").html(e)});var B=$('input[name="delivery"]'),y=$(".type-delever"),g=$('input[name="type-delivery"]'),S=$(".bus"),k=$(".delivery-address"),T=$(".address");S.hide(),k.hide(),y.hide(),"Доставка"===$('input[name="delivery"]:checked').val()?y.show():(y.hide(),g.prop("checked",!1),T.val(""),k.hide(),S.hide());var z=$('input[name="type-delivery"]:checked').val();"Автобус"===z||void 0==z?(S.show(),k.hide(),T.val("")):(k.show(),S.hide()),B.on("change",function(){"Доставка"===$('input[name="delivery"]:checked').val()?y.show():(y.hide(),g.prop("checked",!1),T.val(""),k.hide(),S.hide())}),g.on("change",function(){"Автобус"===$('input[name="type-delivery"]:checked').val()?(S.show(),k.hide(),T.val("")):(k.show(),S.hide())}),d.keyup(function(){searchPassports($(this).val(),c)}),u.keyup(function(){searchPassports($(this).val(),i)}),p.keyup(function(){searchPassports($(this).val(),l)}),m.keyup(function(){searchPassports($(this).val(),r)}),"/"===window.location.pathname?$(".chat").show():$(".chat").hide(),$(".patter").each(function(){$(this).keyup(function(){var e=$(this).val(),t=/[!@#$%^&*()_\\;,."']/i.test(e);t&&(t=e.replace(/[!@#$%^&*()_\\;,."']/i,""),t&&Snackbar.show({text:"Записи разделаются только пробелом!",pos:"top-center",actionText:null}),$(this).val(t))})}),$("#print").click(function(){window.print()}),status()});var mas=[];$(document).on("select2:select","#grammpapper",function(e){mas.push(e.params.data.text+"; "),$(".resultBoxGramm").last().append('<div class="childrenBoxGramm" contenteditable="true"><button type="button" class="close closeBoxGramm">×</button><div class="textBoxGramm">'+e.params.data.text+"</div></div>")}),$(document).on("click",".addBoxGramm",function(e){$(".gramm-modal-body").append('<div class="carBoxGramm"><button type="button" class="close closeCarBoxGramm">×</button><h4 class="modal-title">Значения для машины</h4><div class="resultBoxGramm"></div></div>')}),$(document).on("click",".childrenBoxGramm",function(){$(this).parents(".childrenBoxGramm").text()}),$(document).on("click",".closeBoxGramm",function(){$(this).parents(".childrenBoxGramm").remove()}),$(document).on("click",".closeCarBoxGramm",function(){$(this).parent().remove()}),$(document).on("click",".resultButtonGramm",function(){var e="";$(".resultBoxGramm").length>1?(e="",$(".resultBoxGramm").each(function(){$(this).find(".textBoxGramm").each(function(){e+=$(this).text()+"; "}),e+="//"}),e=e.substring(0,e.length-2)):$(".resultBoxGramm").each(function(){e="",$(this).find(".textBoxGramm").each(function(){e+=$(this).text()+"; "})}),$("#modalGramm").modal("toggle"),$(".typePaperGramm").val(e)}),$(document).on("click",".addSetGramm",function(){$(".carBoxGramm").remove();for(var e=$(".typePaperGramm").val().split("//"),t="",a=0;a<e.length;a++)$(".gramm-modal-body").append('<div class="carBoxGramm"><button type="button" class="close closeCarBoxGramm">×</button><h4 class="modal-title">Значения для машины</h4><div class="resultBoxGramm"></div></div>');$(".carBoxGramm").each(function(a,n){t=e[a].split("; "),t=_.compact(t);var o=$(this);t.forEach(function(e){o.find(".resultBoxGramm").append('<div class="childrenBoxGramm" contenteditable="true"><button type="button" class="close closeBoxGramm">×</button><div class="textBoxGramm">'+e+"</div></div>")})})});var mas=[];$(document).on("select2:select","#sizepapper",function(e){mas.push(e.params.data.text+"; "),$(".resultBoxSize").last().append('<div class="childrenBoxSize" contenteditable="true"><button type="button" class="close closeBoxSize">×</button><div class="textBoxSize">'+e.params.data.text+"</div></div>")}),$(document).on("click",".addBoxSize",function(e){$(".size-modal-body").append('<div class="carBoxSize"><button type="button" class="close closeCarBoxSize">×</button><h4 class="modal-title">Значения для машины</h4><div class="resultBoxSize"></div></div>')}),$(document).on("click",".childrenBoxSize",function(){$(this).parents(".childrenBoxSize").text()}),$(document).on("click",".closeBoxSize",function(){$(this).parents(".childrenBoxSize").remove()}),$(document).on("click",".closeCarBoxSize",function(){$(this).parent().remove()}),$(document).on("click",".resultButtonSize",function(){var e="";$(".resultBoxSize").length>1?(e="",$(".resultBoxSize").each(function(){$(this).find(".textBoxSize").each(function(){e+=$(this).text()+"; "}),e+="//"}),e=e.substring(0,e.length-2)):$(".resultBoxSize").each(function(){e="",$(this).find(".textBoxSize").each(function(){e+=$(this).text()+"; "})}),$("#modalSize").modal("toggle"),$(".typePaperSize").val(e)}),$(document).on("click",".addSetSize",function(){$(".carBoxSize").remove();for(var e=$(".typePaperSize").val().split("//"),t="",a=0;a<e.length;a++)$(".size-modal-body").append('<div class="carBoxSize"><button type="button" class="close closeCarBoxSize">×</button><h4 class="modal-title">Значения для машины</h4><div class="resultBoxSize"></div></div>');$(".carBoxSize").each(function(a,n){t=e[a].split("; "),t=_.compact(t);var o=$(this);t.forEach(function(e){o.find(".resultBoxSize").append('<div class="childrenBoxSize" contenteditable="true"><button type="button" class="close closeBoxSize">×</button><div class="textBoxSize">'+e+"</div></div>")})})});var mas=[];$(document).on("select2:select","#typepapper",function(e){mas.push(e.params.data.text+"; "),$(".resultBoxType").last().append('<div class="childrenBoxType" contenteditable="true"><button type="button" class="close closeBoxType">×</button><div class="textBoxType">'+e.params.data.text+"</div></div>")}),$(document).on("click",".addBoxType",function(e){$(".type-modal-body").append('<div class="carBoxType"><button type="button" class="close closeCarBoxType">×</button><h4 class="modal-title">Значения для машины</h4><div class="resultBoxType"></div></div>')}),$(document).on("click",".childrenBoxType",function(){$(this).parents(".childrenBoxType").text()}),$(document).on("click",".closeBoxType",function(){$(this).parents(".childrenBoxType").remove()}),$(document).on("click",".closeCarBoxType",function(){$(this).parent().remove()}),$(document).on("click",".resultButtonType",function(){var e="";$(".resultBoxType").length>1?(e="",$(".resultBoxType").each(function(){$(this).find(".textBoxType").each(function(){e+=$(this).text()+"; "}),e+="//"}),e=e.substring(0,e.length-2)):$(".resultBoxType").each(function(){e="",$(this).find(".textBoxType").each(function(){e+=$(this).text()+"; "})}),$("#modalType").modal("toggle"),$(".typePaper").val(e)}),$(document).on("click",".addSetType",function(){$(".carBoxType").remove();var e=$(".typePaper").val().split("//"),t="";console.log(e);for(var a=0;a<e.length;a++)$(".type-modal-body").append('<div class="carBoxType"><button type="button" class="close closeCarBoxType">×</button><h4 class="modal-title">Значения для машины</h4><div class="resultBoxType"></div></div>');$(".carBoxType").each(function(a,n){t=e[a].split("; "),t=_.compact(t);var o=$(this);t.forEach(function(e){o.find(".resultBoxType").append('<div class="childrenBoxType" contenteditable="true"><button type="button" class="close closeBoxType">×</button><div class="textBoxType">'+e+"</div></div>")})})}),$(function(){var e=($("#savePassportBtn"),$("#formPassport")),t=io();e.on("submit",function(e){var a={};a.sizePaper=[],a.typePaper=[],a.typePaperSize=[],a.typePaperGramm=[],a.decoration=[],a.manager=[],a.allCar=[],a.passOn=$(".pass-on").val()||"",a.timePassport=$(".time").val()||"",a.contactPerson=$(".contact-person").val()||"",a.phone=$(".phone").val()||"",a.customer=$(".customer").val()||"",a.name=$(".name").val()||"",a.circulationFiled=$(".circulation").val()||"",a.page=$(".page").val()||"",a.redness=$(".redness").val()||"",a.file=$(".fileText").val()||"",a.comment=$(".comment").val()||"",a.address=$(".address").val()||"",a.date=moment().format("DD.MM.YYYY")||"",a.timeSave=moment().format("hh:mm")||"",a.passportId=moment().format("DDMMYYYY")||"",a.deliveryFiled=$('input[name="delivery"]:checked').val()||"",a.typeDeliveryFiled=$('input[name="type-delivery"]:checked').val()||"",a.sizePaper=$(".size-paper").val()||[],a.typePaper=$(".typePaper").val()||"",a.typePaperSize=$(".typePaperSize").val()||"",a.typePaperGramm=$(".typePaperGramm").val()||"",a.set=$(".set").val()||"",a.decoration=$(".decoration").val()||"",a.manager=$(".manager").val()||[],a.managerId=$("#managerId").val(),a.status="new",$(".car-container").each(function(){var e={};e.car=$(this).find(".car-select").val(),e.sht=$(this).find(".Sht").val(),e.on=$(this).find(".on").val(),e.printSheet=$(this).find(".printSheet").val(),e.allSheet=$(this).find(".allSheet").val(),e.signature=$(this).find(".signature").val(),a.allCar.push(e)});var n=!0;if(t.emit("savePassportBtn",a),t.on("readySavePassport",function(e){412===e.status?(Snackbar.show({text:e.msg,pos:"top-center",actionText:null}),n=!1):n=!0}),!n)return!1}),$("#updatePassportBtn").on("click",function(e){var a={};a.sizePaper=[],a.typePaper=[],a.typePaperSize=[],a.typePaperGramm=[],a.decoration=[],a.manager=[],a.allCar=[],a.passOn=$(".pass-on").val()||"",a.timePassport=$(".time").val()||"",a.contactPerson=$(".contact-person").val()||"",a.phone=$(".phone").val()||"",a.customer=$(".customer").val()||"",a.name=$(".name").val()||"",a.circulationFiled=$(".circulation").val()||"",a.page=$(".page").val()||"",a.redness=$(".redness").val()||"",a.file=$(".fileText").val()||"",a.comment=$(".comment").val()||"",a.address=$(".address").val()||"",a.date=moment().format("DD.MM.YYYY")||"",a.timeSave=moment().format("hh:mm")||"",a.passportId=moment().format("DDMMYYYY")||"",a.deliveryFiled=$('input[name="delivery"]:checked').val()||"",a.typeDeliveryFiled=$('input[name="type-delivery"]:checked').val()||"",a.sizePaper=$(".size-paper").val()||[],a.typePaper=$(".typePaper").val()||"",a.typePaperSize=$(".typePaperSize").val()||"",a.typePaperGramm=$(".typePaperGramm").val()||"",a.set=$(".set").val()||"",a.decoration=$(".decoration").val()||"",a.manager=$(".manager").val()||[],a.managerId=$(".managerId").val(),$(".car-container").each(function(){var e={};e.car=$(this).find(".car-select").val(),e.sht=$(this).find(".Sht").val(),e.on=$(this).find(".on").val(),e.printSheet=$(this).find(".printSheet").val(),e.allSheet=$(this).find(".allSheet").val(),e.signature=$(this).find(".signature").val(),a.allCar.push(e)});var n=window.location.pathname.split("/")[3],o=!0;if(t.emit("updatePassportBtn",{data:a,id:n}),t.on("readyUpdatePassport",function(e){412===e.status?(Snackbar.show({text:e.msg,pos:"top-center",actionText:null}),o=!1):(Snackbar.show({text:e.msg,pos:"top-center",actionText:null}),o=!0)}),!o)return!1})}),$(function(){var e=$("#profileUpdate"),t={};e.click(function(){t.name=$("#name").val(),$.ajax({url:"/manager/profile",type:"post",data:t,success:function(e){Snackbar.show({text:"Данные успешно сохраненны!",pos:"bottom-left",actionText:null})},error:function(e){Snackbar.show({text:"Что-то пошло не так!",pos:"bottom-left",actionText:null})}})})}),$(function(){$("#saveUser").click(function(){var e={};e.email=$('input[name="email"]').val(),e.role=$('input[name="role"]').val(),e.name=$('input[name="name"]').val();var t=[];$(".permiss").each(function(){var e={};e.name=$(this).find(".name").val(),e.access=+$(this).find(".access").val(),t.push(e)}),e.permissions=t,$.ajax({type:"POST",data:{data:JSON.stringify(e)},success:function(e){Snackbar.show({text:"Данные успешно сохраненны!",pos:"bottom-left",actionText:null})},error:function(e){Snackbar.show({text:"Что-то пошло не так! "+e,pos:"bottom-left",actionText:null})}})})});